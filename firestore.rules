/**
 * @file Firestore Security Rules for Lexora Drafts application.
 *
 * Core Philosophy:
 * This ruleset prioritizes user authentication and data access control for user profiles,
 * while allowing public read access to legal templates,
 * law feed updates, and the legal glossary.
 *
 * Data Structure:
 * - /users/{userId}: Stores user profiles, accessible only to the authenticated user.
 * - /users/{userId}/activities/{activityId}: Stores activity logs, accessible only to the owner.
 * - /templates/{templateId}: Stores legal templates, publicly readable.
 * - /lawFeed/{updateId}: Stores law feed updates, publicly readable.
 * - /glossary/{termId}: Stores legal terms and definitions, publicly readable.
 *
 * Key Security Decisions:
 * - Strict user-ownership model for user profiles and their activities.
 * - Public read access for /templates, /lawFeed, and /glossary.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to user profiles and their subcollections.
     * @path /users/{userId}
     */
    match /users/{userId} {
      function isOwner() {
        return request.auth.uid == userId;
      }

      // User profiles can only be read or written to by the owner.
      allow read, write: if isOwner();

      /**
       * @description Controls access to a user's recent activity log.
       * @path /users/{userId}/activities/{activityId}
       */
      match /activities/{activityId} {
        // Only the owner can read or write their own activity.
        allow read, write: if isOwner();
      }
    }

    /**
     * @description Allows public read access to legal templates.
     * @path /templates/{templateId}
     */
    match /templates/{templateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to law feed updates.
     * @path /lawFeed/{updateId}
     */
    match /lawFeed/{updateId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }

    /**
     * @description Allows public read access to glossary terms.
     * @path /glossary/{termId}
     */
    match /glossary/{termId} {
      allow get, list: if true;
      allow create, update, delete: if false;
    }
  }
}
